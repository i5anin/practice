<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Калькулятор: цена в человеко-часы/дни</title>
    <style>
        :root { color-scheme: light dark; font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
        body { margin: 24px; max-width: 860px; }
        h1 { font-size: 20px; margin: 0 0 16px; }
        section { border: 1px solid var(--border, #ccc); border-radius: 12px; padding: 16px; margin: 16px 0; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        label { display: grid; gap: 6px; font-size: 14px; }
        input, select { padding: 10px 12px; font-size: 16px; border-radius: 10px; border: 1px solid #aaa; }
        button { padding: 10px 14px; font-size: 16px; border-radius: 10px; border: 1px solid #888; background: none; cursor: pointer; }
        .output { display: grid; gap: 8px; font-size: 16px; }
        .card { display: grid; gap: 10px; padding: 12px; border: 1px dashed #888; border-radius: 10px; }
        .row { display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: center; }
        .value { font-variant-numeric: tabular-nums; }
        small { color: #666; }
        @media (max-width: 700px) { .grid { grid-template-columns: 1fr; } .row { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
<h1>Калькулятор перевода стоимости в человеко-часы и дни</h1>

<section id="profile">
    <div class="grid">
        <label>Месячная зарплата
            <input id="salary" type="number" inputmode="decimal" placeholder="например, 150000" value="103000">
        </label>
        <label>Символ валюты
            <input id="currency" maxlength="6" placeholder="₽, $, €, ₸ …" value="₽">
        </label>
        <label>Рабочих дней в месяце
            <input id="workDays" type="number" inputmode="numeric" min="1" max="31" value="22">
        </label>
        <label>Часов в рабочем дне
            <input id="hoursPerDay" type="number" inputmode="decimal" min="1" max="24" value="8">
        </label>
    </div>
    <div style="margin-top:12px; display:flex; gap:8px;">
        <button id="save">Сохранить параметры</button>
        <button id="reset">Сбросить</button>
    </div>
    <div class="output" style="margin-top:12px;">
        <div class="row"><div>Почасовая ставка</div><div class="value" id="hourRate">—</div></div>
        <div class="row"><div>Дневная ставка</div><div class="value" id="dayRate">—</div></div>
    </div>
</section>

<section id="custom">
    <div class="grid">
        <label>Название позиции
            <input id="itemName" placeholder="например, Ноутбук">
        </label>
        <label>Цена позиции
            <input id="itemPrice" type="number" inputmode="decimal" placeholder="например, 120000">
        </label>
    </div>
    <div style="margin-top:12px;">
        <button id="calc">Рассчитать</button>
    </div>
    <div class="output" id="customOut" style="margin-top:12px; display:none;"></div>
</section>

<section id="presets">
    <div class="grid">
        <div class="card">
            <div class="row"><div><strong>Айфон</strong></div><div class="value"><span id="planePrice">107000</span></div></div>
            <button data-target="plane">Рассчитать для айфон</button>
            <div class="output" id="planeOut" style="display:none;"></div>
        </div>
        <div class="card">
            <div class="row"><div><strong>Авто</strong></div><div class="value"><span id="carPrice">2800000</span></div></div>
            <button data-target="car">Рассчитать для авто</button>
            <div class="output" id="carOut" style="display:none;"></div>
        </div>
    </div>
</section>

<script type="module">
    const el = id => document.getElementById(id)
    const s = {
        salary: el('salary'),
        currency: el('currency'),
        workDays: el('workDays'),
        hoursPerDay: el('hoursPerDay'),
        hourRate: el('hourRate'),
        dayRate: el('dayRate'),
        itemName: el('itemName'),
        itemPrice: el('itemPrice'),
        customOut: el('customOut'),
        planeOut: el('planeOut'),
        carOut: el('carOut')
    }
    const fmtNum = v => new Intl.NumberFormat('ru-RU', { maximumFractionDigits: 2 }).format(v)
    const fmtMoney = (v, cur) => `${fmtNum(v)} ${cur}`

    function getProfile() {
        const salary = Number(s.salary.value)
        const workDays = Number(s.workDays.value)
        const hoursPerDay = Number(s.hoursPerDay.value)
        const currency = String(s.currency.value || '₽')
        if (!Number.isFinite(salary) || salary <= 0) return null
        if (!Number.isFinite(workDays) || workDays <= 0) return null
        if (!Number.isFinite(hoursPerDay) || hoursPerDay <= 0) return null
        return { salary, workDays, hoursPerDay, currency }
    }

    function updateRates() {
        const p = getProfile()
        if (!p) { s.hourRate.textContent = '—'; s.dayRate.textContent = '—'; return }
        const dayRate = p.salary / p.workDays
        const hourRate = dayRate / p.hoursPerDay
        s.hourRate.textContent = fmtMoney(hourRate, p.currency)
        s.dayRate.textContent = fmtMoney(dayRate, p.currency)
    }

    function calcFor(price, label) {
        const p = getProfile()
        if (!p) return { ok: false, html: '<div>Укажите корректную зарплату и график.</div>' }
        if (!Number.isFinite(price) || price <= 0) return { ok: false, html: '<div>Цена должна быть больше нуля.</div>' }
        const months = price / p.salary
        const days = price * p.workDays / p.salary
        const hours = days * p.hoursPerDay
        const dayRate = p.salary / p.workDays
        const hourRate = dayRate / p.hoursPerDay
        const html = `
    <div class="row"><div>Позиция</div><div class="value">${label}</div></div>
    <div class="row"><div>Цена</div><div class="value">${fmtMoney(price, p.currency)}</div></div>
    <div class="row"><div>Месяцы труда</div><div class="value">${fmtNum(months)}</div></div>
    <div class="row"><div>Человеко-дни</div><div class="value">${fmtNum(days)}</div></div>
    <div class="row"><div>Человеко-часы</div><div class="value">${fmtNum(hours)}</div></div>
    <div class="row"><div>Почасовая ставка</div><div class="value">${fmtMoney(hourRate, p.currency)}</div></div>
    <div class="row"><div>Дневная ставка</div><div class="value">${fmtMoney(dayRate, p.currency)}</div></div>
    <small>Расчёт: месяцы = цена / зарплата; дни = цена × рабочие_дни / зарплата; часы = дни × часов_в_дне.</small>
  `
        return { ok: true, html }
    }

    function render(outEl, res) {
        outEl.style.display = 'grid'
        outEl.innerHTML = res.html
    }

    function saveProfile() {
        const p = getProfile()
        if (!p) return
        localStorage.setItem('wageProfile', JSON.stringify(p))
        updateRates()
    }

    function loadProfile() {
        const raw = localStorage.getItem('wageProfile')
        if (!raw) { updateRates(); return }
        try {
            const p = JSON.parse(raw)
            if (p.salary) s.salary.value = p.salary
            if (p.currency) s.currency.value = p.currency
            if (p.workDays) s.workDays.value = p.workDays
            if (p.hoursPerDay) s.hoursPerDay.value = p.hoursPerDay
        } catch {}
        updateRates()
    }

    function resetProfile() {
        localStorage.removeItem('wageProfile')
        s.salary.value = ''
        s.currency.value = '₽'
        s.workDays.value = 22
        s.hoursPerDay.value = 8
        updateRates()
        s.customOut.style.display = 'none'
        s.planeOut.style.display = 'none'
        s.carOut.style.display = 'none'
    }

    document.addEventListener('input', e => {
        if (['salary','currency','workDays','hoursPerDay'].includes(e.target.id)) updateRates()
    })

    el('save').addEventListener('click', saveProfile)
    el('reset').addEventListener('click', resetProfile)

    el('calc').addEventListener('click', () => {
        const name = s.itemName.value.trim() || 'Позиция'
        const price = Number(s.itemPrice.value)
        const res = calcFor(price, name)
        render(s.customOut, res)
    })

    document.querySelectorAll('button[data-target]').forEach(btn => {
        btn.addEventListener('click', () => {
            const t = btn.getAttribute('data-target')
            if (t === 'plane') {
                const price = Number(document.getElementById('planePrice').textContent)
                const res = calcFor(price, 'Самолёт')
                render(s.planeOut, res)
            }
            if (t === 'car') {
                const price = Number(document.getElementById('carPrice').textContent)
                const res = calcFor(price, 'Авто')
                render(s.carOut, res)
            }
        })
    })

    loadProfile()
</script>
</body>
</html>